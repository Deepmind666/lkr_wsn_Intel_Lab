#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n\n\"\"\"\nç»¼åˆç®—æ³•è¯„ä¼°ç»“æœå¯è§†åŒ–\n\"\"\"\n\nimport json\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport numpy as np\nfrom pathlib import Path\nimport os\nfrom datetime import datetime\n\ndef load_comprehensive_results(json_file: str) -> pd.DataFrame:\n    \"\"\"åŠ è½½ç»¼åˆå®éªŒç»“æœå¹¶è½¬æ¢ä¸ºDataFrame\"\"\"\n    with open(json_file, 'r', encoding='utf-8') as f:\n        results = json.load(f)\n    \n    # æå–æ¯ä¸ªç®—æ³•çš„metrics\n    data = []\n    for result in results:\n        if 'algorithm' in result and 'metrics' in result:\n            row = {'Algorithm': result['algorithm']}\n            row.update(result['metrics'])\n            data.append(row)\n    \n    return pd.DataFrame(data)\n\ndef create_comprehensive_plots(df: pd.DataFrame, output_dir: str):\n    \"\"\"åˆ›å»ºç»¼åˆç®—æ³•å¯¹æ¯”å›¾è¡¨\"\"\"\n    os.makedirs(output_dir, exist_ok=True)\n    timestamp = datetime.now().strftime(\"%Y%m%d_%H%M%S\")\n    \n    # è®¾ç½®ç»˜å›¾é£æ ¼\n    plt.style.use('seaborn-v0_8-whitegrid')\n    sns.set_palette(\"husl\")\n    \n    # 1. ç»¼åˆæ€§èƒ½é›·è¾¾å›¾\n    fig, ax = plt.subplots(figsize=(10, 8), subplot_kw=dict(projection='polar'))\n    \n    # é€‰æ‹©å…³é”®æŒ‡æ ‡\n    metrics = ['energy_efficiency', 'network_lifetime', 'routing_success_rate', \n               'convergence_speed', 'adaptability', 'explainability']\n    \n    # å½’ä¸€åŒ–æ•°æ®åˆ°0-1èŒƒå›´\n    df_norm = df.copy()\n    for metric in metrics:\n        if metric in df.columns:\n            max_val = df[metric].max()\n            if max_val > 0:\n                df_norm[metric] = df[metric] / max_val\n            else:\n                df_norm[metric] = 0\n    \n    # ç»˜åˆ¶æ¯ä¸ªç®—æ³•\n    angles = np.linspace(0, 2 * np.pi, len(metrics), endpoint=False).tolist()\n    angles += angles[:1]  # é—­åˆå›¾å½¢\n    \n    for i, row in df_norm.iterrows():\n        values = [row.get(metric, 0) for metric in metrics]\n        values += values[:1]  # é—­åˆå›¾å½¢\n        \n        ax.plot(angles, values, 'o-', linewidth=2, label=row['Algorithm'])\n        ax.fill(angles, values, alpha=0.25)\n    \n    ax.set_xticks(angles[:-1])\n    ax.set_xticklabels([m.replace('_', ' ').title() for m in metrics])\n    ax.set_ylim(0, 1)\n    ax.legend(loc='upper right', bbox_to_anchor=(1.3, 1.0))\n    ax.set_title('ç»¼åˆç®—æ³•æ€§èƒ½å¯¹æ¯”é›·è¾¾å›¾', size=16, pad=20)\n    \n    plt.tight_layout()\n    plt.savefig(f\"{output_dir}/comprehensive_radar_{timestamp}.png\", dpi=300, bbox_inches='tight')\n    plt.savefig(f\"{output_dir}/comprehensive_radar_{timestamp}.pdf\", bbox_inches='tight')\n    plt.close()\n    \n    # 2. å…³é”®æŒ‡æ ‡æ¡å½¢å›¾å¯¹æ¯”\n    fig, axes = plt.subplots(2, 3, figsize=(15, 10))\n    axes = axes.flatten()\n    \n    for i, metric in enumerate(metrics):\n        if metric in df.columns:\n            ax = axes[i]\n            values = df[metric].fillna(0)\n            bars = ax.bar(df['Algorithm'], values, alpha=0.8)\n            ax.set_title(metric.replace('_', ' ').title())\n            ax.set_ylabel('Score')\n            \n            # æ·»åŠ æ•°å€¼æ ‡ç­¾\n            for bar, val in zip(bars, values):\n                if not np.isnan(val) and val != 0:\n                    ax.text(bar.get_x() + bar.get_width()/2, bar.get_height() + max(values)*0.01,\n                            f'{val:.3f}', ha='center', va='bottom')\n            \n            ax.tick_params(axis='x', rotation=45)\n    \n    plt.tight_layout()\n    plt.savefig(f\"{output_dir}/comprehensive_metrics_{timestamp}.png\", dpi=300, bbox_inches='tight')\n    plt.savefig(f\"{output_dir}/comprehensive_metrics_{timestamp}.pdf\", bbox_inches='tight')\n    plt.close()\n    \n    # 3. ç®—æ³•å¤æ‚åº¦vsæ•ˆæœæ•£ç‚¹å›¾\n    fig, ax = plt.subplots(figsize=(10, 8))\n    \n    x = df['computational_complexity'].fillna(0)\n    y = df['energy_efficiency'].fillna(0)\n    \n    scatter = ax.scatter(x, y, s=100, alpha=0.7, c=range(len(df)), cmap='viridis')\n    \n    for i, row in df.iterrows():\n        ax.annotate(row['Algorithm'], \n                   (row.get('computational_complexity', 0), row.get('energy_efficiency', 0)),\n                   xytext=(5, 5), textcoords='offset points')\n    \n    ax.set_xlabel('è®¡ç®—å¤æ‚åº¦ (s)', fontsize=12)\n    ax.set_ylabel('èƒ½è€—æ•ˆç‡', fontsize=12)\n    ax.set_title('ç®—æ³•å¤æ‚åº¦ vs èƒ½è€—æ•ˆç‡', fontsize=14)\n    ax.grid(True, alpha=0.3)\n    \n    plt.tight_layout()\n    plt.savefig(f\"{output_dir}/complexity_vs_efficiency_{timestamp}.png\", dpi=300, bbox_inches='tight')\n    plt.savefig(f\"{output_dir}/complexity_vs_efficiency_{timestamp}.pdf\", bbox_inches='tight')\n    plt.close()\n    \n    # 4. ç®—æ³•æ€»ç»“è¡¨æ ¼\n    summary_metrics = ['energy_efficiency', 'network_lifetime', 'routing_success_rate', \n                      'computational_complexity']\n    \n    fig, ax = plt.subplots(figsize=(12, 6))\n    ax.axis('tight')\n    ax.axis('off')\n    \n    # å‡†å¤‡è¡¨æ ¼æ•°æ®\n    table_data = []\n    for _, row in df.iterrows():\n        row_data = [row['Algorithm']]\n        for metric in summary_metrics:\n            val = row.get(metric, 0)\n            if pd.isna(val):\n                row_data.append('N/A')\n            else:\n                row_data.append(f'{val:.3f}')\n        table_data.append(row_data)\n    \n    headers = ['Algorithm'] + [m.replace('_', ' ').title() for m in summary_metrics]\n    \n    table = ax.table(cellText=table_data, colLabels=headers, cellLoc='center', loc='center')\n    table.auto_set_font_size(False)\n    table.set_fontsize(10)\n    table.scale(1.2, 1.5)\n    \n    # è®¾ç½®è¡¨æ ¼æ ·å¼\n    for (i, j), cell in table.get_celld().items():\n        if i == 0:  # è¡¨å¤´\n            cell.set_text_props(weight='bold')\n            cell.set_facecolor('#4CAF50')\n            cell.set_text_props(color='white')\n        else:\n            cell.set_facecolor('#f1f1f2')\n    \n    plt.title('ç®—æ³•æ€§èƒ½å¯¹æ¯”æ±‡æ€»è¡¨', fontsize=16, pad=20)\n    plt.tight_layout()\n    plt.savefig(f\"{output_dir}/comprehensive_summary_{timestamp}.png\", dpi=300, bbox_inches='tight')\n    plt.savefig(f\"{output_dir}/comprehensive_summary_{timestamp}.pdf\", bbox_inches='tight')\n    plt.close()\n    \n    print(f\"âœ… ç»¼åˆç®—æ³•å¯¹æ¯”å›¾è¡¨å·²ç”Ÿæˆåˆ°: {output_dir}\")\n    print(f\"ğŸ“Š ç”Ÿæˆçš„å›¾è¡¨:\")\n    print(f\"   - æ€§èƒ½é›·è¾¾å›¾: comprehensive_radar_{timestamp}.png\")\n    print(f\"   - å…³é”®æŒ‡æ ‡å¯¹æ¯”: comprehensive_metrics_{timestamp}.png\")\n    print(f\"   - å¤æ‚åº¦vsæ•ˆç‡: complexity_vs_efficiency_{timestamp}.png\")\n    print(f\"   - æ€§èƒ½æ±‡æ€»è¡¨: comprehensive_summary_{timestamp}.png\")\n\ndef main():\n    \"\"\"ä¸»å‡½æ•°\"\"\"\n    # æŸ¥æ‰¾æœ€æ–°çš„comprehensiveç»“æœæ–‡ä»¶\n    results_dir = Path(\"results/data\")\n    json_files = list(results_dir.glob(\"comprehensive_results_*.json\"))\n    \n    if not json_files:\n        print(\"âŒ æœªæ‰¾åˆ°comprehensiveå®éªŒç»“æœæ–‡ä»¶\")\n        return\n    \n    # ä½¿ç”¨æœ€æ–°çš„æ–‡ä»¶\n    latest_file = max(json_files, key=lambda x: x.stat().st_mtime)\n    print(f\"ğŸ“‚ ä½¿ç”¨ç»“æœæ–‡ä»¶: {latest_file}\")\n    \n    # åŠ è½½æ•°æ®\n    df = load_comprehensive_results(str(latest_file))\n    print(f\"ğŸ“Š åŠ è½½äº†{len(df)}ä¸ªç®—æ³•çš„ç»“æœ\")\n    print(f\"ç®—æ³•åˆ—è¡¨: {', '.join(df['Algorithm'].tolist())}\")\n    \n    # ç”Ÿæˆå›¾è¡¨\n    output_dir = \"experiments/results/figures\"\n    create_comprehensive_plots(df, output_dir)\n\nif __name__ == \"__main__\":\n    main()\n"
